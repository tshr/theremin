add jasmine tests
add promise support for Safari